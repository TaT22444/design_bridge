---
const currentLang = Astro.url.searchParams.get('lang') || 'ja';
---

<div class="relative">
  <select 
    id="language-switcher" 
    class="bg-white border border-gray-300 rounded-lg px-3 py-2 pr-8 text-sm appearance-none cursor-pointer hover:border-gray-400 focus:border-gray-900 focus:ring-2 focus:ring-gray-200"
    onchange="switchLanguage(this.value)"
  >
    <option value="ja" selected={currentLang === 'ja'}>🇯🇵 日本語</option>
    <option value="zh-TW" selected={currentLang === 'zh-TW'}>🇹🇼 繁體中文</option>
  </select>
  <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </div>
</div>

<script>
  function switchLanguage(lang: string): void {
    const url = new URL(window.location.href);
    url.searchParams.set('lang', lang);
    window.location.href = url.toString();
  }
  
  // Make function globally available
  (window as any).switchLanguage = switchLanguage;
  
  // Set correct value on page load
  document.addEventListener('DOMContentLoaded', function() {
    const switcher = document.getElementById('language-switcher') as HTMLSelectElement;
    const currentLang = new URLSearchParams(window.location.search).get('lang') || 'ja';
    if (switcher) {
      switcher.value = currentLang;
    }
  });
</script> 